<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cls.taishan.demo.dao.DemoDao">
	<resultMap type="cls.taishan.demo.model.DemoUser" id="user">
		<id column="admin_id" property="id" />
		<result column="admin_realname" property="realName" />
		<result column="admin_login" property="loginId" />
		<result column="admin_password" property="password" />
		<result column="admin_gender" property="gender" />
		<result column="admin_email" property="email" />
		<result column="admin_birthday" property="birthday" />
		<result column="ADMIN_MOBILE" property="mobilePhone" />
		<result column="ADMIN_TEL" property="officePhone" />
		<result column="ADMIN_PHONE" property="homePhone" />
		<result column="admin_address" property="homeAddress" />
		<result column="admin_org" property="institutionCode" />
		<result column="admin_status" property="status" />
		<result column="login_status" property="loginStatus" />
		<result column="is_collecter" property="isCollector" />
		<result column="is_warehouse_m" property="isWarehouseManger" />
		<result column="admin_create_time" property="createTime" />
		<result column="create_admin_id" property="createAdminId" />
		<result column="admin_login_time" property="loginTime" />
		<result column="admin_login_count" property="loginCount" />
		<result column="org_name" property="institutionName" />
		<result column="admin_remark" property="remark" />
		<result column="warehouse_code" property="warehouseCode" />
		<result column="warehouse_name" property="warehouseName" />
		<result column="org_leader" property="institutionLeader" />
	</resultMap>
	
	<select id="getUserList" parameterType="cls.taishan.demo.form.DemoForm" resultType="cls.taishan.demo.model.DemoUser">
		SELECT admin_id id,
		       admin_realname realName,
		       admin_login loginId,
		       admin_org institutionCode,
		       org_name institutionName,
		       admin_mobile mobilePhone,
		       ADMIN_ADDRESS homeAddress,
		       is_collecter isCollector
		  FROM adm_info JOIN inf_orgs ON (admin_org = org_code)
		 WHERE 1=1
		 <if test="orgCode!=null and orgCode != ''">
		 	and admin_org = #{orgCode}
		 </if>
		 <if test="userName!=null and userName != ''">
		 	and admin_realname like '%${userName}%'
		 </if>
	</select>
	
	<update id="updateUser" parameterType="cls.taishan.demo.model.DemoUser">
		update adm_info 
		set ADMIN_REALNAME = #{realName},
			ADMIN_ORG = #{institutionCode}, 
			ADMIN_REMARK = #{remark}
		where admin_id = #{id}
	</update>
	
	<select id="getUserList2" parameterType="cls.taishan.demo.form.DemoForm" resultType="cls.taishan.demo.model.DemoUser">
		select id,realName,loginId,institutionCode,institutionName,mobilePhone,homeAddress,isCollector,createTime from (
			select tab.*,rownum rn from (
			SELECT admin_id id,
			               admin_realname realName,
			               admin_login loginId,
			               admin_org institutionCode,
			               org_name institutionName,
			               admin_mobile mobilePhone,
			               ADMIN_ADDRESS homeAddress,
			               ADMIN_CREATE_TIME createTime,
			               is_collecter isCollector
			          FROM adm_info LEFT JOIN inf_orgs ON (admin_org = org_code)
			          order by id 
			 <![CDATA[     ) tab where rownum <= #{endNum}  ]]>  
			          ) where rn > #{beginNum} 
			          <if test="sortName!=null and sortName != ''">
						 	 order by ${sortName} ${sortOrder}
					  </if>
			         
	</select>

</mapper>
