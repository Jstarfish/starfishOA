                 TAISHAN 3.0 HOST INSTALLATION GUIDE

PREPARATION

A. Add user 'taishan', who belongs to group 'taishan'.
    adduser taishan
    passwd taishan

B. Establish the run-directory of host
    mkdir /ts_host/
    mkdir /ts_host/ipcs
    touch /ts_host/ipcs/shm.key
    touch /ts_host/ipcs/sem.key
    touch /ts_host/ipcs/msg.key
    mkdir /ts_host/logs

C. Make /ts_host and its subdirectories belong to user 'taishan'
    chown -R taishan:taishan /ts_host/


INSTALLATION OF 3RD-PARTY PACKAGES

Taishan 3.0 needs the following seven third-party packages to compile and run:

       NAME                     VERSION      INSTALL_METHOD
    1. CMake                      2.8.2      source build, package provided
    2. Oracle Instant Client   11.2.0.3      source build, package provided
    3. Oracle Call Interface   11.2.0.3      source build, package provided
    4. SQLite3                  3.7.7.1      source incorporated in host
    5. GLib2                       2.22      yum package install
    6. NCurses Library              5.7      yum package install
    7. OpenSSL                   1.0.1e      yum package install

CMake:
    1. Unzip the tarball
        tar xvfz cmake-2.8.2.tar.gz
    2. Enter cmake directory
        cd cmake-2.8.2
    3. Compile
        ./configure
        make
    4. Install (as superuser)
        make install

Oracle Instant Client:
    1. Move the tarball to taishan's home directory
        mv ora_client_110204.tar.gz /home/taishan
    2. Unzip the tarball
        tar xvfz ora_client_110204.tar.gz
    3. Set environment variables, add the following to ~/.bash_profile
        export ORACLE_HOME=/home/taishan/ora_client
        LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$ORACLE_HOME
        export LD_LIBRARY_PATH
        export NLS_LANG=AMERICAN_AMERICA.ZHS16GBK
        export PATH=$PATH:$ORACLE_HOME
        export TNS_ADMIN=$ORACLE_HOME
        export ORA_NLS10=$ORACLE_HOME/nls/data
    4. Exit and re-login as 'taishan'
        exit
        ssh taishan@YOUR_HOST_IP
    5. Modify the file /home/taishan/ora_client/tnsnames.ora
        tnsnames.ora
        --------------------------------------------------------------------------------
        ORCL =                                                           #name of connection
        (DESCRIPTION =
        (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.26.194)(PORT = 1521)) #uncrypted connection, change this ip
            (CONNECT_DATA =
            (SERVER = DEDICATED)
            (SERVICE_NAME = orcl)                                        #service name, can be modified
            )
        )
        --------------------------------------------------------------------------------
    6. Test the connection of database with sqlplus
        sqlplus taishan/oracle@orcl

Oracle Call Interface:
    1. Change the owner of the tarball to 'taishan'
        chown -R taishan:taishan oci.tar.bz2
    2. Move the tarball to /ts_host
        mv oci.tar.bz2 /ts_host
    3. Unzip the tarball
        tar xvfj oci.tar.bz2
    4. Remove the unnecessary tarball
        rm -rf oci.tar.bz2

GLib2:
    yum install glib2-devel.x86_64

NCurses:
    yum install ncurses-devel.x86_64

OpenSSL:
    yum install openssl-devel.x86_64

There is no need to install SQLite3 because its code has already been incorporated
into the host.


COMPILATION AND INSTALLATION OF HOST

Go to the 'build' of your source directory, and type
    cmake ..   (or 'cmake -DCMAKE_BUILD_TYPE=Debug ..' if you want debug mode)
    make
    make install (as superuser)


RUN HOST

After the configuration files in /ts_host/conf have all been changed properly,
go to /ts_host/sbin and run

    ./ts_servctl start

The host will start boot itself. To stop host, type

    ./ts_servctl stop

    
CONFIG JOB-SCHEDULER

When the host is successfully started, we need to add a time-based job into
crontab by typing

	crontab -e

as user 'taishan' and append the following line 

	0 */2 * * * /ts_host/sbin/clear_snapshot.sh >> /ts_host/logs/clear_snapshot.log

and then restart the cron service by typing (as root)

	service smb restart


CHANGELOG

-- 2014, Apr, 24th -- Document created by Shawn Qingxiang Wang
-- 2014, May, 27th -- Add cmake command for debug mode
