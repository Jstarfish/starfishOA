<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cls.pilottery.oms.lottery.dao.AbandonAwardDao">

	<resultMap type="cls.pilottery.oms.lottery.model.AbandonAward" id="abandonAwardInfo">
		<result column="PAY_DATE" property="payDate"/>
		<result column="GAME_CODE" property="gameCode"/>
		<result column="ISSUE_NUMBER" property="issueNumber"/>
		<result column="PRIZE_LEVEL" property="prizeLevel"/>
		<result column="PRIZE_BET_COUNT" property="prizeBetCount"/>
		<result column="PRIZE_TICKET_COUNT" property="prizeTicketCount"/>
		<result column="IS_HD_PRIZE" property="isHdPrize"/>
		<result column="WINNINGAMOUNTTAX" property="winningAmountTax"/>
		<result column="WINNINGAMOUNT" property="winningAmount"/>
		<result column="TAXAMOUNT" property="taxAmount"/>
	</resultMap>
	
	<select id="getCount" parameterType="cls.pilottery.oms.lottery.model.AbandonAward" resultType="Integer">
		select count(1)
 	 	from (
 	 		select t.prize_bet_count, t.prize_ticket_count, t.winningamounttax
          	from MIS_REPORT_GUI_ABAND t, inf_games u
          	where t.game_code = u.game_code(+)
          	and		t.prize_level = -1
          	<if test="gameCode!=null and gameCode!=0">
          		and t.GAME_CODE = #{gameCode}
          	</if>
          	<if test="payDateStart != null and payDateStart != ''">
          	<![CDATA[and to_date(to_char(t.PAY_DATE,'yyyy-MM-dd'),'yyyy-MM-dd') >= to_date(#{payDateStart},'yyyy-MM-dd')]]>
          	</if>
          	<if test="payDateEnd != null and payDateEnd != ''">
          	<![CDATA[and to_date(to_char(t.PAY_DATE,'yyyy-MM-dd'),'yyyy-MM-dd') <= to_date(#{payDateEnd},'yyyy-MM-dd')]]>
          	</if>
          	<if test="issueNumberStart != null and issueNumberStart != ''">
          	<![CDATA[and t.ISSUE_NUMBER >= to_number(#{issueNumberStart})]]>
          	</if>
          	<if test="issueNumberEnd != null and issueNumberEnd != ''">
          	<![CDATA[and t.ISSUE_NUMBER <= to_number(#{issueNumberEnd})]]>
          	</if>
         )
	</select>
	
	<select id="getAbandonAwardList" parameterType="cls.pilottery.oms.lottery.model.AbandonAward" resultType="java.util.HashMap">
		select * from (
			select a.*,rownum rn from (
				select t.prize_bet_count "allBetCount", t.prize_ticket_count "allTicketCount", t.winningamounttax "allWinningAmountTax", 
						to_char(t.pay_date, 'yyyy-MM-dd') "payDate", t.issue_number "issueNumber", t.game_code "gameCode", u.short_name "shortName"
				from MIS_REPORT_GUI_ABAND t, inf_games u
				where t.game_code = u.game_code(+)
				and		t.prize_level = -1
				<if test="gameCode!=null and gameCode!=0">
	          		and t.GAME_CODE = #{gameCode}
	          	</if>
				<if test="payDateStart != null and payDateStart != ''">
	          	<![CDATA[and to_date(to_char(t.PAY_DATE,'yyyy-MM-dd'),'yyyy-MM-dd') >= to_date(#{payDateStart},'yyyy-MM-dd')]]>
	          	</if>
	          	<if test="payDateEnd != null and payDateEnd != ''">
	          	<![CDATA[and to_date(to_char(t.PAY_DATE,'yyyy-MM-dd'),'yyyy-MM-dd') <= to_date(#{payDateEnd},'yyyy-MM-dd')]]>
	          	</if>
	          	<if test="issueNumberStart != null and issueNumberStart != ''">
	          	<![CDATA[and t.ISSUE_NUMBER >= to_number(#{issueNumberStart})]]>
	          	</if>
	          	<if test="issueNumberEnd != null and issueNumberEnd != ''">
	          	<![CDATA[and t.ISSUE_NUMBER <= to_number(#{issueNumberEnd})]]>
	          	</if>
	          	order by t.pay_date desc, t.issue_number desc
			) a
		)
		<![CDATA[ where rn > #{beginNum} and rn <= #{endNum} ]]>
	</select>
	
	<select id="getAbandonAwardDetailList" parameterType="cls.pilottery.oms.lottery.model.AbandonAward" resultType="java.util.HashMap">
	  SELECT t.prize_bet_count "allBetCount",
       t.prize_ticket_count "allTicketCount",
       t.winningamounttax "allWinningAmountTax", t.pay_date "payDate",
       t.issue_number "issueNumber", t.game_code "gameCode",
       t.prize_level "prizeLevel", r.prule_name "ruleName"
		  FROM mis_report_gui_aband t
		  LEFT JOIN gp_prize_rule r
		    ON r.game_code = t.game_code
		   AND t.prize_level = r.prule_level
		 WHERE t.prize_level > -1
          and  t.pay_date = to_date(#{payDate},'yyyy-MM-dd') 
          and  t.game_code = to_number(#{gameCode})
          and  t.issue_number = to_number(#{issueNumber})
         order by t.pay_date
	</select>

</mapper>
