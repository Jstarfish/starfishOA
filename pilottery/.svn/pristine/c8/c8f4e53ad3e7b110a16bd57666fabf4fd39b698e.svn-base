<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cls.pilottery.oms.game.dao.GameManagementDao">

<resultMap type="cls.pilottery.oms.game.model.GameInfo" id="gameInfo">
  <id column="GAME_CODE" property="gameCode" />
  <result column="GAME_MARK" property="gameMark" />
  <result column="FULL_NAME" property="fullName" />
  <result column="SHORT_NAME" property="shortName" />
  <result column="BASIC_TYPE" property="basicType" />
  <result column="ISSUING_ORGANIZATION" property="issuingOrganization" />
</resultMap>

<resultMap type="cls.pilottery.oms.game.model.GamePolicyParam" id="gamePolicyParam">
  <id column="HIS_POLICY_CODE" property="hisPolicyCode" />
  <id column="GAME_CODE" property="gameCode" />
  <result column="HIS_MODIFY_DATE" property="hisModifyDate" />
  <result column="THEORY_RATE" property="theoryRate"/>
  <result column="FUND_RATE" property="fundRate" />
  <result column="ADJ_RATE" property="adjRate" />
  <result column="TAX_THRESHOLD" property="taxThreshold" />
  <result column="TAX_RATE" property="taxRate" />
  <result column="DRAW_LIMIT_DAY" property="drawLimitDay" />
</resultMap>

<resultMap type="cls.pilottery.oms.game.model.GameDrawDevice" id="gameDrawDevice">
  <id column="DEVICE_ID" property="id" />
  <result column="DEVICE_NAME" property="name" />
  <result column="IP_ADDR" property="ipAddr" />
  <result column="DEVICE_TYPE" property="type" />
  <result column="DEVICE_STATUS" property="status" />
  <result column="GAME_CODE" property="gameCode" />
</resultMap>

<resultMap type="cls.pilottery.oms.game.model.GameParameterControlView" id="gameParameterControlView">
  <result column="GAME_CODE" property="gameCode" />
  <result column="LIMIT_BIG_PRIZE" property="limitBigPrize" />
  <result column="LIMIT_PAYMENT" property="limitPayment" />
  <result column="LIMIT_PAYMENT2" property="limitPayment2" />
  <result column="LIMIT_CANCEL2" property="limitCancel2" />
  <result column="CANCEL_SEC" property="cancelSec" />
  <result column="SALER_PAY_LIMIT" property="salerPayLimit" />
  <result column="SALER_CANCEL_LIMIT" property="salerCancelLimit" />
  <result column="ISSUE_CLOSE_ALERT_TIME" property="issueCloseAlertTime" />
</resultMap>

<resultMap type="cls.pilottery.oms.game.model.GamePoolHis" id="gamePoolHis">
  <id column="HIS_CODE" property="hisCode" />
  <result column="POOL_FLOW" property="poolFlow" jdbcType="CHAR" javaType="java.lang.String" />
  <result column="GAME_CODE" property="gameCode" />
  <result column="POOL_CODE" property="poolCode" />
  <result column="POOL_ADJ_TYPE" property="poolAdjType" />
  <result column="CHANGE_AMOUNT" property="changeAmount" />
  <result column="ADJ_REASON" property="adjReason" />
  <result column="POOL_AMOUNT_BEFORE" property="poolAmountBefore" />
  <result column="POOL_AMOUNT_AFTER" property="poolAmountAfter" />
  <result column="ADJ_TIME" property="adjTime" />
  <result column="ISSUE_NUMBER" property="issueNumber" />
</resultMap>

<resultMap type="cls.pilottery.oms.game.model.GameRule" id="gameRule">
  <id column="HIS_RULE_CODE" property="hisRuleCode" />
  <id column="GAME_CODE" property="gameCode" />
  <id column="RULE_CODE" property="ruleCode" />
  <result column="RULE_NAME" property="ruleName" />
  <result column="RULE_DESC" property="ruleDesc" />
  <result column="HIS_MODIFY_DATE" property="hisModifyDate" />
  <result column="RULE_ENABLE" property="ruleEnable" />
</resultMap>

<resultMap type="cls.pilottery.oms.game.model.GamePrizeRule" id="gamePrizeRule">
  <id column="HIS_PRIZE_CODE" property="hisPrizeCode" />
  <id column="GAME_CODE" property="gameCode" />
  <id column="PRULE_LEVEL" property="pruleLevel" />
  <result column="HIS_MODIFY_DATE" property="hisModifyDate" />
  <result column="PRULE_NAME" property="pruleName" />
  <result column="PRULE_DESC" property="pruleDesc" />
  <result column="LEVEL_PRIZE" property="levelPrize" />
</resultMap>

<resultMap type="cls.pilottery.oms.game.model.GameWinRule" id="gameWinRule">
  <id column="HIS_WIN_CODE" property="hisWinCode" />
  <id column="GAME_CODE" property="gameCode" />
  <id column="WRULE_CODE" property="wRuleCode" />
  <result column="HIS_MODIFY_DATE" property="hisModifyDate" />
  <result column="WRULE_NAME" property="wRuleName" />
  <result column="WRULE_DESC" property="wRuleDesc" />
</resultMap>

<resultMap type="cls.pilottery.oms.game.model.GameParameterNormalView" id="gameParameterNormalView">
  <result column="GAME_CODE" property="gameCode" />
  <result column="DRAW_MODE" property="drawMode" />
  <result column="SINGLEBET_AMOUNT" property="singleBetAmount"/>
  <result column="SINGLETICKET_MAX_ISSUES" property="singleTicketMaxIssues" />
  <result column="SINGLELINE_MAX_AMOUNT" property="singleLineMaxAmount" />
  <result column="SINGLETICKET_MAX_LINE" property="singleTicketMaxLine" />
  <result column="SINGLETICKET_MAX_AMOUNT" property="singleTicketMaxAmount" />
  <result column="ABANDON_REWARD_COLLECT" property="abandonRewardCollect" />
</resultMap>

<resultMap type="cls.pilottery.oms.game.model.GameParameterHistory" id="gameParameterHistory">
  <id column="HIS_HIS_CODE" property="hisHisCode" />
  <id column="GAME_CODE" property="gameCode" />
  <result column="HIS_MODIFY_DATE" property="hisModifyDate" />
  <result column="IS_OPEN_RISK" property="isOpenRisk" />
  <result column="RISK_PARAM" property="riskParam" />
</resultMap>

<resultMap type="cls.pilottery.oms.game.model.GameParameterDynamic" id="gameParameterDynamic">
  <id column="GAME_CODE" property="gameCode" />
  <result column="SINGLELINE_MAX_AMOUNT" property="singleLineMaxAmount" />
  <result column="SINGLETICKET_MAX_LINE" property="singleTicketMaxLine" />
  <result column="SINGLETICKET_MAX_AMOUNT" property="singleTicketMaxAmount" />
  <result column="CANCEL_SEC" property="cancelSec" />
  <result column="SALER_PAY_LIMIT" property="salerPayLimit" />
  <result column="SALER_CANCEL_LIMIT" property="salerCancelLimit" />
  <result column="ISSUE_CLOSE_ALERT_TIME" property="issueCloseAlertTime" />
  <result column="IS_PAY" property="isPay" />
  <result column="IS_SALE" property="isSale" />
  <result column="IS_CANCEL" property="isCancel" />
  <result column="IS_AUTO_DRAW" property="isAutoDraw" />
  <result column="SERVICE_TIME_1" property="serviceTime1" />
  <result column="SERVICE_TIME_2" property="serviceTime2" />
  <result column="AUDIT_SINGLE_TICKET_SALE" property="auditSingleTicketSale" />
  <result column="AUDIT_SINGLE_TICKET_PAY" property="auditSingleTicketPay" />
  <result column="AUDIT_SINGLE_TICKET_CANCEL" property="auditSingleTicketCancel" />
  <result column="CALC_WINNING_CODE" property="calcWinningCode" />
</resultMap>

<resultMap type="cls.pilottery.oms.game.model.GamePool" id="gamePool">
  <id column="GAME_CODE" property="gameCode" />
  <id column="POOL_CODE" property="gameCode" />
  <result column="POOL_AMOUNT_AFTER" property="poolAmountAfter" />
  <result column="POOL_NAME" property="poolName" />
  <result column="ADJ_TIME" property="adjTime" />
  <result column="POOL_DESC" property="poolDesc" />
</resultMap>

<resultMap type="cls.pilottery.oms.game.model.SystemParameter" id="systemParameter">
  <id column="SYS_DEFAULT_SEQ" property="sysDefaultSeq" />
  <result column="SYS_DEFAULT_DESC" property="sysDefaultDesc" />
  <result column="SYS_DEFAULT_VALUE" property="sysDefaultValue" />
</resultMap>

<resultMap type="cls.pilottery.oms.game.model.GameIssue" id="gameIssue">
  <id column="GAME_CODE" property="gameCode" />
  <id column="ISSUE_NUMBER" property="issueNumber" />
  <result column="ISSUE_SEQ" property="issueSeq" />
  <result column="ISSUE_STATUS" property="issueStatus" />
  <result column="IS_PUBLISH" property="isPublish" />
  <result column="DRAW_STATE" property="drawStatus" />
  <result column="PLAN_START_TIME" property="planStartTime" />
  <result column="PLAN_CLOSE_TIME" property="planCloseTime" />
  <result column="PLAN_REWARD_TIME" property="planRewardTime" />
  <result column="REAL_START_TIME" property="realStartTime" />
  <result column="REAL_CLOSE_TIME" property="realCloseTime" />
  <result column="REAL_REWARD_TIME" property="realRewardTime" />
  <result column="ISSUE_END_TIME" property="issueEndTime" />
  <result column="CODE_INPUT_METHOLD" property="codeInputMethold" />
  <result column="FIRST_DRAW_USER_ID" property="firstDrawUserId" />
  <result column="FIRST_DRAW_NUMBER" property="firstDrawNumber" />
  <result column="SECOND_DRAW_USER_ID" property="secondDrawUserId" />
  <result column="SECOND_DRAW_NUMBER" property="secondDrawNumber" />
  <result column="FINAL_DRAW_NUMBER" property="finalDrawNumber" />
  <result column="FINAL_DRAW_USER_ID" property="finalDrawUserId" />
  <result column="PAY_END_DAY" property="payEndDay" />
  <result column="POOL_START_AMOUNT" property="poolStartAmount" />
  <result column="POOL_CLOSE_AMOUNT" property="poolCloseAmount" />
  <result column="ISSUE_SALE_AMOUNT" property="issueSaleAmount" />
  <result column="ISSUE_SALE_TICKETS" property="issueSaleTickets" />
  <result column="ISSUE_SALE_BETS" property="issueSaleBets" />
  <result column="ISSUE_CANCEL_AMOUNT" property="issueCancelAmount" />
  <result column="ISSUE_CANCEL_TICKETS" property="issueCancelTickets" />
  <result column="ISSUE_CANCEL_BETS" property="issueCancelBets" />
  <result column="WINNING_AMOUNT" property="winningAmount" />
  <result column="WINNING_BETS" property="winningBets" />
  <result column="WINNING_TICKETS" property="winningTickets" />
  <result column="WINNING_AMOUNT_BIG" property="winningAmountBig" />
  <result column="WINNING_TICKETS_BIG" property="winningTicketsBig" />
  <result column="ISSUE_RICK_AMOUNT" property="issueRickAmount" />
  <result column="ISSUE_RICK_TICKETS" property="issueRickTickets" />
  <result column="WINNING_RESULT" property="winningResult" />
  <result column="REWARDING_ERROR_CODE" property="rewardingErrorCode" />
  <result column="REWARDING_ERROR_MESG" property="rewardingErrorMesg" />
  <result column="CALC_WINNING_CODE" property="calcWinningCode" />
</resultMap>

<select id="getGameInfo" resultMap="gameInfo">
select * from INF_GAMES
</select>

<select id="getGameInfoByCode" parameterType="short" resultMap="gameInfo">  
select * from INF_GAMES where GAME_CODE=#{code}
</select>

<update id="updateGameInfo" parameterType="cls.pilottery.oms.game.model.GameInfo">  
update INF_GAMES r
set    r.GAME_CODE=#{gameCode},
       r.GAME_MARK=#{gameMark},
       r.FULL_NAME=#{fullName},
       r.SHORT_NAME=#{shortName},
       r.BASIC_TYPE=#{basicType},
       r.ISSUING_ORGANIZATION=#{issuingOrganization}
where  r.GAME_CODE=#{gameCode}
</update>

<select id="getPolicyParamByCode" parameterType="short" resultMap="gamePolicyParam">  
select * from GP_POLICY 
where HIS_POLICY_CODE=(select max(HIS_POLICY_CODE) from GP_POLICY where GAME_CODE=#{code})
and GAME_CODE=#{code}
</select>

<update id="updateGamePolicyParam" parameterType="cls.pilottery.oms.game.model.GamePolicyParam">  
update GP_POLICY r
set    r.THEORY_RATE=#{theoryRate},
       r.FUND_RATE=#{fundRate},
       r.ADJ_RATE=#{adjRate},
       r.TAX_THRESHOLD=#{taxThreshold},
       r.TAX_RATE=#{taxRate},
       r.DRAW_LIMIT_DAY=#{drawLimitDay}
where  r.GAME_CODE=#{gameCode}
</update>

<select id="getDeviceListCount" parameterType="cls.pilottery.oms.game.model.GameDrawDevice" resultType="Integer">
select count(1) from inf_devices d
</select>

<select id="getDeviceList" parameterType="cls.pilottery.oms.game.model.GameDrawDevice" resultMap="gameDrawDevice">
select * from (
    select a.*,rownum rn from (
        select * from inf_devices d 
<![CDATA[ order by d.DEVICE_ID) a ) where rn > ${beginNum} and rn <= ${endNum} ]]>
</select>

<select id="getNormalRuleView" parameterType="short" resultMap="gameParameterNormalView">
select * from v_gp_normal_rule where GAME_CODE=#{gameCode}
</select>

<select id="getGameParameterHistory" parameterType="short" resultMap="gameParameterHistory">
select * from GP_HISTORY t where t.GAME_CODE=#{gameCode} and t.his_his_code=
    (select max(his_his_code) from GP_HISTORY where GAME_CODE=#{gameCode})
</select> 

<select id="getGameParameterHistoryByNum" parameterType="map" resultMap="gameParameterHistory">
SELECT *  FROM GP_HISTORY t  WHERE t.GAME_CODE = #{gameCode}
   AND t.his_his_code = (select HIS_HIS_CODE from iss_current_param where game_code = #{gameCode} and issue_number = #{issueNumber})
</select> 

<select id="getGameParameterDynamicByCode" parameterType="short" resultMap="gameParameterDynamic">
	select * from GP_DYNAMIC where GAME_CODE=#{gameCode}
</select>

<select id="getControlView" parameterType="short" resultMap="gameParameterControlView">  
	select * from v_gp_control where GAME_CODE=#{gameCode}
</select>

<update id="updateControlParameter1" parameterType="cls.pilottery.oms.game.model.GameParameterDynamic">  
	update GP_DYNAMIC r
	set    r.AUDIT_SINGLE_TICKET_SALE=#{auditSingleTicketSale},
	       r.AUDIT_SINGLE_TICKET_PAY=#{auditSingleTicketPay},
	       r.AUDIT_SINGLE_TICKET_CANCEL=#{auditSingleTicketCancel}
	where  r.GAME_CODE=#{gameCode}
</update>

<update id="updateControlParameter2" parameterType="cls.pilottery.oms.game.model.GameParameterDynamic">  
update GP_DYNAMIC r
set    r.SERVICE_TIME_1=#{serviceTime1},
       r.SERVICE_TIME_2=#{serviceTime2}
where  r.GAME_CODE=#{gameCode}
</update>

<update id="updateGameParameterNormalView" parameterType="cls.pilottery.oms.game.model.GameParameterNormalView">
update v_gp_normal_rule r
set    r.SINGLELINE_MAX_AMOUNT=#{singleLineMaxAmount},
       r.SINGLETICKET_MAX_LINE=#{singleTicketMaxLine},
       r.SINGLETICKET_MAX_AMOUNT=#{singleTicketMaxAmount}
where  r.GAME_CODE=#{gameCode}
</update>

<update id="updateControlParameter_S" parameterType="cls.pilottery.oms.game.model.GameParameterControlView">  
update GP_STATIC r set 
       r.LIMIT_PAYMENT2=#{limitPayment2},
       r.LIMIT_CANCEL2=#{limitCancel2}
where  r.GAME_CODE=#{gameCode}
</update>

<update id="updateControlParameter_D" parameterType="cls.pilottery.oms.game.model.GameParameterControlView">  
update GP_DYNAMIC r set 
       r.CANCEL_SEC=#{cancelSec},
       r.ISSUE_CLOSE_ALERT_TIME=#{issueCloseAlertTime}
where  r.GAME_CODE=#{gameCode}
</update>

<select id="getPoolAdjListCount" parameterType="cls.pilottery.oms.game.form.GameManagementForm" resultType="Integer">
select count(1) from ISS_GAME_POOL_HIS d where d.GAME_CODE=${gamePoolHis.gameCode}
<if test="str_adjTime1 != null and str_adjTime1 != ''">
<![CDATA[ and to_char(d.adj_time,'yyyy-MM-dd') >= '${str_adjTime1}' ]]>
</if>
<if test="str_adjTime2 != null and str_adjTime2 != ''">
<![CDATA[ and to_char(d.adj_time,'yyyy-MM-dd') <= '${str_adjTime2}' ]]>
</if>
</select>

<select id="getPoolAdjList" parameterType="cls.pilottery.oms.game.form.GameManagementForm" resultMap="gamePoolHis">
select * from (
    select a.*,rownum rn from (
        select * from ISS_GAME_POOL_HIS d where d.GAME_CODE=${gamePoolHis.gameCode} 
<if test="str_adjTime1 != null and str_adjTime1 != ''">
<![CDATA[ and to_char(d.adj_time,'yyyy-MM-dd') >= '${str_adjTime1}' ]]>
</if>
<if test="str_adjTime2 != null and str_adjTime2 != ''">
<![CDATA[ and to_char(d.adj_time,'yyyy-MM-dd') <= '${str_adjTime2}' ]]>
</if>
<![CDATA[ order by d.his_Code desc) a ) where rn > ${gamePoolHis.beginNum} and rn <= ${gamePoolHis.endNum} ]]>
</select>

<insert id="insertPoolAdj" statementType="CALLABLE" parameterType="cls.pilottery.oms.game.model.GamePoolAdj">  
{
    call p_om_add_pool(
        #{gameCode,mode=IN,jdbcType=NUMERIC},
        #{poolAdjType,mode=IN,jdbcType=NUMERIC},
        #{adjAmount,mode=IN,jdbcType=NUMERIC},
        #{adjDesc,mode=IN,jdbcType=VARCHAR},
        #{adjAdmin,mode=IN,jdbcType=NUMERIC},
        #{c_errcode,mode=OUT,jdbcType=NUMERIC},
        #{c_errmsg,mode=OUT,jdbcType=VARCHAR},
        #{c_add_now,mode=OUT,jdbcType=NUMERIC}
    )
}
</insert>

<select id="getGameRuleByCode" parameterType="short" resultMap="gameRule">  
select * from GP_RULE where GAME_CODE=#{gameCode} order by RULE_CODE asc
</select>

<select id="getGamePrizeRuleByCode" parameterType="short" resultMap="gamePrizeRule">  
select * from GP_PRIZE_RULE t where t.GAME_CODE=#{gameCode} 
and t.his_prize_code = (select max(his_prize_code) from GP_PRIZE_RULE where GAME_CODE=#{gameCode})
order by disp_order asc
</select>

<update id="updateGameRule" parameterType="cls.pilottery.oms.game.model.GameRule">  
update GP_RULE r
set    r.RULE_DESC=#{ruleDesc}
where  r.GAME_CODE=#{gameCode}
and    r.HIS_RULE_CODE=#{hisRuleCode}
and    r.RULE_CODE=#{ruleCode}
</update>

<select id="getMaxBaseCode" parameterType="short" resultType="long">
select max(HIS_BASE_CODE) from his_game_parameter where GAME_CODE=#{gameCode}
</select>

<select id="getMaxPolicyCode" parameterType="short" resultType="long">
select max(HIS_POLICY_CODE) from GP_POLICY where GAME_CODE=#{gameCode}
</select>

<select id="getMaxRuleCode" parameterType="short" resultType="long">
select max(HIS_RULE_CODE) from his_game_rule where GAME_CODE=#{gameCode}
</select>

<select id="getMaxPrizeCode" parameterType="short" resultType="long">
select max(HIS_PRIZE_CODE) from GP_PRIZE_RULE where GAME_CODE=#{gameCode}
</select>

<select id="getMaxWinCode" parameterType="short" resultType="long">
select max(HIS_WIN_CODE) from GP_WIN_RULE where GAME_CODE=#{gameCode}
</select>

<select id="getGamePrizeRuleByKey" parameterType="cls.pilottery.oms.game.model.GamePrizeRule" resultMap="gamePrizeRule">
select * from GP_PRIZE_RULE where GAME_CODE=#{gameCode} and his_prize_code=#{hisPrizeCode} 
</select>

<insert id="updateRiskParam" parameterType="cls.pilottery.oms.game.model.GameParameterHistory">
insert into GP_HISTORY(HIS_HIS_CODE,GAME_CODE,IS_OPEN_RISK,RISK_PARAM,HIS_MODIFY_DATE)
values(#{hisHisCode},
       #{gameCode},
       #{isOpenRisk},
       #{riskParam},
       #{hisModifyDate})
</insert>

<select id="getGameWinRuleByCode" parameterType="short" resultMap="gameWinRule">
    select * from GP_WIN_RULE where GAME_CODE=#{gameCode} order by GAME_CODE asc
</select>

<update id="changeParamStatus" parameterType="cls.pilottery.oms.game.model.GameParameterDynamic">
update GP_DYNAMIC r set 
       <if test="isSale != null">
       r.IS_SALE=#{isSale}
       </if>
       <if test="isPay != null">
       r.IS_PAY=#{isPay}
       </if>
       <if test="isCancel != null">
       r.IS_CANCEL=#{isCancel}
       </if>
       <if test="isAutoDraw != null">
       r.IS_AUTO_DRAW=#{isAutoDraw}
       </if>
where  r.GAME_CODE=#{gameCode}
</update>

<select id="getDeviceListByCode" parameterType="short" resultMap="gameDrawDevice">
select * from inf_devices d where d.GAME_CODE=#{gameCode}
</select>

<select id="getGamePool" parameterType="short" resultMap="gamePool">
select * from ISS_GAME_POOL where GAME_CODE=#{code}
</select>

<select id="getSystemParameterList" resultMap="systemParameter">
select * from SYS_PARAMETER order by SYS_DEFAULT_SEQ
</select>

<update id="updateSystemParameter" statementType="CALLABLE" parameterType="cls.pilottery.oms.game.form.GameManagementForm">
{
    call p_om_update_sysparam(
        #{strP,mode=IN,jdbcType=VARCHAR},
        #{sysParam.c_errcode,mode=OUT,jdbcType=NUMERIC},
        #{sysParam.c_errmsg,mode=OUT,jdbcType=VARCHAR}
    )
}
</update>

<update id="updateCalcWinningCode" parameterType="cls.pilottery.oms.game.model.GameParameterDynamic">
update GP_DYNAMIC r set
       r.CALC_WINNING_CODE=#{calcWinningCode}
where  r.GAME_CODE=#{gameCode}
</update>

<select id="getRiskParam" parameterType="short" resultMap="gameParameterHistory">
select * from GP_HISTORY t where t.GAME_CODE=#{param1} and t.his_his_code=
    (select s.his_his_code from iss_current_param s where s.GAME_CODE=#{param1} and s.issue_number=#{param2})
</select>

<select id="getPolicyParam" parameterType="short" resultMap="gamePolicyParam">
select * from GP_POLICY 
where GAME_CODE=#{param1}
and HIS_POLICY_CODE=(select s.HIS_POLICY_CODE from iss_current_param s where s.GAME_CODE=#{param1} and s.issue_number=#{param2})
</select>

<select id="getCurrentIssue" parameterType="cls.pilottery.oms.game.model.GameIssue" resultMap="gameIssue">
select * from iss_game_issue t
where t.GAME_CODE=#{gameCode}
and t.issue_status=#{issueStatus}
</select>

<select id="getGameIssueListCount" parameterType="cls.pilottery.oms.game.form.GameManagementForm" resultType="Integer"> 
select count(1) from iss_game_issue d where d.GAME_CODE=${gameIssue.gameCode}
<if test="gameIssue.isPublish != null">
and d.IS_PUBLISH=${gameIssue.isPublish}
</if>
<if test="gameIssue.issueNumber != null">
<![CDATA[ and d.ISSUE_NUMBER <= ${gameIssue.issueNumber} ]]>
</if>
<if test="beginIssue != null">
<![CDATA[ and d.ISSUE_NUMBER >= ${beginIssue} ]]>
</if>
<if test="str_adjTime1 != null and str_adjTime1 != ''">
and to_char(d.plan_start_time,'yyyy-MM-dd')='${str_adjTime1}'
</if>
<if test="gameIssue.issueStatus == 1">
and d.ISSUE_STATUS=0
</if>
<if test="gameIssue.issueStatus == 2">
and d.ISSUE_STATUS=1
</if>
<if test="gameIssue.issueStatus == 3">
and d.ISSUE_STATUS in (2,3)
</if>
<if test="gameIssue.issueStatus == 4">
and d.ISSUE_STATUS=4
</if>
<if test="gameIssue.issueStatus == 5">
and d.ISSUE_STATUS=5
</if>
<if test="gameIssue.issueStatus == 6">
and d.ISSUE_STATUS in (6,7,8,9,10,11,12)
</if>
<if test="gameIssue.issueStatus == 7">
and d.ISSUE_STATUS=13
</if>
</select>

<select id="getGameIssueList" parameterType="cls.pilottery.oms.game.form.GameManagementForm" resultMap="gameIssue">
select * from (
select a.*,rownum rn from (
select * from iss_game_issue d where d.GAME_CODE=${gameIssue.gameCode} 
<if test="gameIssue.isPublish != null">
and d.IS_PUBLISH=${gameIssue.isPublish}
</if>
<if test="gameIssue.issueNumber != null">
<![CDATA[ and d.ISSUE_NUMBER <= ${gameIssue.issueNumber} ]]>
</if>
<if test="beginIssue != null">
<![CDATA[ and d.ISSUE_NUMBER >= ${beginIssue} ]]>
</if>
<if test="str_adjTime1 != null and str_adjTime1 != ''">
and to_char(d.plan_start_time,'yyyy-MM-dd')='${str_adjTime1}'
</if>
<if test="gameIssue.issueStatus == 1">
and d.ISSUE_STATUS=0
</if>
<if test="gameIssue.issueStatus == 2">
and d.ISSUE_STATUS=1
</if>
<if test="gameIssue.issueStatus == 3">
and d.ISSUE_STATUS in (2,3)
</if>
<if test="gameIssue.issueStatus == 4">
and d.ISSUE_STATUS=4
</if>
<if test="gameIssue.issueStatus == 5">
and d.ISSUE_STATUS=5
</if>
<if test="gameIssue.issueStatus == 6">
and d.ISSUE_STATUS in (6,7,8,9,10,11,12)
</if>
<if test="gameIssue.issueStatus == 7">
and d.ISSUE_STATUS=13
</if>
<![CDATA[ order by d.ISSUE_NUMBER desc) a ) where rn > ${gameIssue.beginNum} and rn <= ${gameIssue.endNum} ]]>
</select>

<!-- 期次状态（1=预售；2=游戏期开始；3=期即将关闭；4=游戏期关闭；5=数据封存完毕；6=开奖号码已录入；7=销售已经匹配；
8=已录入奖级奖金；9=本地算奖完成；10=奖级已确认；11=开奖确认；12=中奖数据已录入数据库；13=期结全部完成） 
-->
<select id="checkIssueExist"  parameterType="short" resultType="Integer">
select count(*) from iss_game_issue t where t.game_code=#{gameCode}
<![CDATA[ and t.issue_status < 5 ]]>
</select>

</mapper>