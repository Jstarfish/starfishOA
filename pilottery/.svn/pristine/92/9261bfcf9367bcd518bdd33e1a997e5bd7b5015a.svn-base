<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cls.taishan.web.issue.dao.IssueDao">
	
	<select id="getIssueCount" parameterType="cls.taishan.web.issue.form.IssueForm" resultType="int">
		select count(1) from
		   (select t.game_code as gameCode,
			       t.issue_number as issueNumber,
			       t.issue_status as issueStatus,
			       t.start_sale_time as startSaleTime,
			       t.end_sale_time as endSaleTime,
			       t.draw_code as drawCode,
			       t.reward_time as rewardTime,
			       t.sale_amount as saleAmount,
			       t.sale_comm as saleComm,
			       t.winning_amount as winningAmount,
			       t.paid_amount as paidAmount
			  from CNCP_GAME_ISSUES t
			  where 1=1
	      <if test="gameCode !=null and gameCode != ''">
		 	and t.game_code = #{gameCode}
		 </if>
	      <if test="issueNumber !=null and issueNumber != ''">
		 	and to_char(t.issue_number) = #{issueNumber}
		 </if>
		 <if test="issueStatus !=null">
		 	and t.issue_status = #{issueStatus}
		 </if>
		 <if test="startSaleTime !=null and startSaleTime != ''">
		 	and to_char(t.start_sale_time,'yyyy-mm-dd') = #{startSaleTime}
		 </if> )
	</select>
	
	<select id="getIssueList" parameterType="cls.taishan.web.issue.form.IssueForm" resultType="cls.taishan.web.issue.model.Issue">
		select * from (select tab.*, rownum rn from (
		select t.game_code as gameCode,
			       t.issue_number as issueNumber,
			       t.issue_status as issueStatus,
			       t.start_sale_time as startSaleTime,
			       t.end_sale_time as endSaleTime,
			       t.draw_code as drawCode,
			       t.reward_time as rewardTime,
			       t.sale_amount as saleAmount,
			       t.sale_comm as saleComm,
			       t.winning_amount as winningAmount,
			       t.paid_amount as paidAmount,
			       a.FULL_NAME as gameName
			  from CNCP_GAME_ISSUES t
			  left join INF_GAMES a on (t.game_code = a.game_code)
			  where 1=1
	      <if test="gameCode !=null and gameCode != ''">
		 	and t.game_code = #{gameCode}
		 </if>
		 <if test="issueNumber !=null and issueNumber != ''">
		 	and to_char(t.issue_number) = #{issueNumber}
		 </if>
		 <if test="issueStatus !=null">
		 	and t.issue_status = #{issueStatus}
		 </if>
		 <if test="startSaleTime !=null and startSaleTime != ''">
		 	and to_char(t.start_sale_time,'yyyy-mm-dd') = #{startSaleTime}
		 </if> order by t.issue_number desc
		 <![CDATA[ ) tab where rownum <= #{endNum}  ]]>  
			       ) where rn > #{beginNum}
		 <if test="sortName!=null and sortName != ''">
				order by ${sortName} ${sortOrder}
		 </if>
	</select>
	
	
</mapper>
