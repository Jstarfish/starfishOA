<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cls.taishan.cncp.cmi.dao.TransFerDao">
    <update id="lotteryBet" statementType="CALLABLE" parameterType="cls.taishan.cncp.cmi.model.Req1002Msg">
                {call   p_cncp_sale(
                    #{ticketId,mode=IN,jdbcType=VARCHAR},
                    #{gameCode,mode=IN,jdbcType=NUMERIC},
                    #{issue,mode=IN,jdbcType=NUMERIC},
                    #{dealer,mode=IN,jdbcType=VARCHAR},
                    #{amount,mode=IN,jdbcType=VARCHAR},
                    #{betLines,mode=IN,jdbcType=VARCHAR},
                    #{responseCode,mode=OUT,jdbcType=NUMERIC},
                    #{responseMsg,mode=OUT,jdbcType=VARCHAR}
                    )
                }
        </update>

    <select id="queryGameName" resultType="String" parameterType="Integer">
        SELECT GAME_MARK as gameName
        FROM INF_GAMES WHERE GAME_CODE = #{game,jdbcType=NUMERIC}
    </select>

    <select id="queryNewIssue" resultType="Integer" parameterType="Integer">
        select t.issue_number issue
        from ISS_GAME_ISSUE t
        where t.game_code= #{game,jdbcType=NUMERIC}
        and t.issue_status = 2
    </select>

    <select id="lotteryQuery" resultType="cls.taishan.cncp.cmi.model.Res5003Msg" parameterType="String">
      SELECT SALE_FLOW as ticketId,
             ORDER_STATUS as status
             FROM CNCP_TRADE_SALE WHERE SALE_FLOW = #{ticketId,jdbcType=VARCHAR}
    </select>

    <select id="payOffQuery" resultType="cls.taishan.cncp.cmi.entity.Res5004Model" parameterType="Map">
        SELECT SALE_FLOW as ticketId,
               IS_BIG_REWARD as bigBonus,
               REWARD_AMOUNT as amount
               FROM CNCP_TRADE_PAID where
               GAME_CODE=#{game,jdbcType=NUMERIC}
               and ISSUE_NUMBER=#{issue,jdbcType=NUMERIC}
    </select>

    <select id="getNextSeq" resultType="long">
        select F_GET_SYS_HOSTLOGID_SEQ from dual
    </select>

    <update id="updateLotterySuccess" statementType="CALLABLE" parameterType="Map">
        {call   p_cncp_ticket_succ(
            #{ticketId,mode=IN,jdbcType=VARCHAR},
            #{tsn,mode=IN,jdbcType=VARCHAR},
            #{responseCode,mode=OUT,jdbcType=NUMERIC},
            #{responseMsg,mode=OUT,jdbcType=VARCHAR}
            )
        }
    </update>

    <update id="updateLotteryFail" statementType="CALLABLE" parameterType="Map">
        {call   p_cncp_ticket_fail(
            #{ticketId,mode=IN,jdbcType=VARCHAR},
            #{responseCode,mode=OUT,jdbcType=NUMERIC},
            #{responseMsg,mode=OUT,jdbcType=VARCHAR}
            )
        }
    </update>
    
    <select id="getOrderCountByTicketId" resultType="Integer" parameterType="String">
        select count(1) from cncp_trade_sale where sale_flow = #{_parameter}
    </select>
</mapper>