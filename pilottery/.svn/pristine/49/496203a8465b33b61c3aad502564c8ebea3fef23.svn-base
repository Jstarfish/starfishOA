<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cls.pilottery.web.report.dao.SaleReportDao">
	<select id="getGameSalesList" parameterType="cls.pilottery.web.report.form.SaleReportForm" resultType="cls.pilottery.web.report.model.SalesReportModel">
		SELECT SALE_DAY saleDate,
		       FULL_NAME gameName,
		       SUM(SALE_AMOUNT) salesAmount,
		       SUM(SALE_COMM) salesCommission,
		       SUM(PAY_AMOUNT) payoutAmount,
		       SUM(PAY_COMM) payoutCommission,
		      SUM( SALE_AMOUNT-SALE_COMM-PAY_AMOUNT-PAY_COMM) cashIncome
		  FROM v_report_sale_pay 
		  LEFT JOIN GAME_PLANS USING (PLAN_CODE)
		  WHERE 1 = 1
		  <if test="beginDate != null and beginDate != ''">
				AND SALE_DAY between #{beginDate} and #{endDate}
		  </if>
		  <if test="planCode != null and planCode != ''">
				AND plan_code = #{planCode}
		  </if>
		  <if test="cuserOrg != '00'">
			and ORG_CODE = #{cuserOrg}
		  </if>
	      GROUP BY SALE_DAY,FULL_NAME,PLAN_CODE
 	      ORDER BY PLAN_CODE,SALE_DAY DESC
	</select>
	
	<select id="getGameSalesSum" parameterType="cls.pilottery.web.report.form.SaleReportForm" resultType="cls.pilottery.web.report.model.SalesReportModel">
		SELECT sum(SALE_AMOUNT) salesAmount,
		       sum(SALE_COMM) salesCommission,
		       sum(PAY_AMOUNT) payoutAmount,
		       sum(PAY_COMM) payoutCommission,
		       sum(SALE_AMOUNT-SALE_COMM-PAY_AMOUNT-PAY_COMM) cashIncome
		  FROM v_report_sale_pay 
		  LEFT JOIN GAME_PLANS USING (PLAN_CODE)
		  WHERE 1 = 1
		  <if test="beginDate != null and beginDate != ''">
			  AND SALE_DAY between #{beginDate} and #{endDate}
		  </if>
		  <if test="planCode != null and planCode != ''">
			  AND plan_code = #{planCode}
		  </if>
		  <if test="cuserOrg != '00'">
			and ORG_CODE = #{cuserOrg}
		  </if>
	</select>
	
	<select id="getInstitutionSalesList" parameterType="cls.pilottery.web.report.form.SaleReportForm" resultType="cls.pilottery.web.report.model.SalesReportModel">
		SELECT FULL_NAME gameName,
		       ORG_NAME orgName,
		       SUM(SALE_AMOUNT) salesAmount,
		       SUM(SALE_COMM) salesCommission,
		       SUM(PAY_AMOUNT) payoutAmount,
		       SUM(PAY_COMM) payoutCommission,
		       SUM(SALE_AMOUNT-SALE_COMM-PAY_AMOUNT-PAY_COMM) cashIncome
		  FROM v_report_sale_pay 
		  LEFT JOIN GAME_PLANS USING (PLAN_CODE)
		  LEFT JOIN INF_ORGS USING (ORG_CODE)
		  WHERE 1 = 1
		  <if test="beginDate != null and beginDate != ''">
		  		AND SALE_DAY between #{beginDate} and #{endDate}
		  </if>
		  <if test="institutionCode != null and institutionCode != ''">
				AND ORG_CODE = #{institutionCode}
		  </if>
		  <if test="cuserOrg != '00'">
			and ORG_CODE = #{cuserOrg}
		  </if>
		  GROUP BY FULL_NAME,ORG_NAME,ORG_CODE,PLAN_CODE
		  ORDER BY ORG_CODE,PLAN_CODE
	</select>
	
	<select id="getInstitutionSalesSum" parameterType="cls.pilottery.web.report.form.SaleReportForm" resultType="cls.pilottery.web.report.model.SalesReportModel">
		SELECT sum(SALE_AMOUNT) salesAmount,
		       sum(SALE_COMM) salesCommission,
		       sum(PAY_AMOUNT) payoutAmount,
		       sum(PAY_COMM) payoutCommission,
		       sum(SALE_AMOUNT-SALE_COMM-PAY_AMOUNT-PAY_COMM) cashIncome
		  FROM v_report_sale_pay 
		  LEFT JOIN GAME_PLANS USING (PLAN_CODE)
		  LEFT JOIN INF_ORGS USING (ORG_CODE)
		  WHERE 1 = 1
		  <if test="beginDate != null and beginDate != ''">
		  		AND SALE_DAY between #{beginDate} and #{endDate}
		  </if>
		  <if test="institutionCode != null and institutionCode != ''">
				AND ORG_CODE = #{institutionCode}
		  </if>
		  <if test="cuserOrg != '00'">
			and ORG_CODE = #{cuserOrg}
		  </if>
	</select>
	
	<select id="getInventoryList" parameterType="cls.pilottery.web.report.form.SaleReportForm" resultType="cls.pilottery.web.report.model.InventoryModel">
		SELECT calc_date calcDate,
		       SUM(tickets) tickets,
		       SUM(amount) amount,
		       full_name gameName
		  FROM v_report_lot_inventory 
		  LEFT JOIN GAME_PLANS USING (PLAN_CODE)
		  WHERE 1 = 1
		  <if test="beginDate != null and beginDate != ''">
		  		AND calc_date between #{beginDate} and #{endDate}
		  </if>
		  <if test="planCode != null and planCode != ''">
				AND plan_code = #{planCode}
		  </if>
		  <if test="warehouseCode != null and warehouseCode != ''">
				AND WAREHOUSE = #{warehouseCode}
		  </if>
		  <if test="cuserOrg != '00'">
			and WAREHOUSE in (select WAREHOUSE_CODE from WH_INFO where org_code = #{cuserOrg})
		  </if>
		   
		  GROUP BY calc_date,full_name
		  ORDER BY calc_date desc,full_name
	</select>
	
	<select id="getInventorySum" parameterType="cls.pilottery.web.report.form.SaleReportForm" resultType="cls.pilottery.web.report.model.InventoryModel">
		SELECT sum(tickets) tickets,
		       sum(amount) amount
		  FROM v_report_lot_inventory 
		  LEFT JOIN GAME_PLANS USING (PLAN_CODE)
		  WHERE 1 = 1
		  <if test="beginDate != null and beginDate != ''">
		  		AND calc_date between #{beginDate} and #{endDate}
		  </if>
		  <if test="planCode != null and planCode != ''">
				AND plan_code = #{planCode}
		  </if>
		  <if test="warehouseCode != null and warehouseCode != ''">
				AND WAREHOUSE = #{warehouseCode}
		  </if>
		  <if test="cuserOrg != '00'">
			and WAREHOUSE in (select WAREHOUSE_CODE from WH_INFO where org_code = #{cuserOrg})
		  </if>
	</select>
	
	<select id="getWarehouseList" parameterType="string" resultType="cls.pilottery.web.report.model.WarehouseModel">
		  select WAREHOUSE_CODE warehouseCode,
		  	WAREHOUSE_NAME warehouseName
		  from WH_INFO
		  WHERE 1=1 
		  <if test="_parameter != '00'">
			and WAREHOUSE_CODE in (select WAREHOUSE_CODE from WH_INFO where org_code = #{_parameter})
		  </if>
	</select>
	
	<select id="getInstitutionList" parameterType="string" resultType="cls.pilottery.web.report.model.InstitutionModel">
		  select ORG_CODE institutionCode, 
		  		 ORG_NAME institutionName
		  from INF_ORGS
		  WHERE 1=1 
		  <if test="_parameter != '00'">
			AND ORG_CODE = #{_parameter}
		  </if>
	</select>

	<select id="getPlanList" resultType="cls.pilottery.web.sales.model.PlanModel">
		select plan_code planCode,full_name planName from game_plans
	</select>
</mapper>