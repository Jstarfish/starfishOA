<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cls.taishan.web.order.dao.PrizeDao">
	
	<select id="getTotalCount" parameterType="cls.taishan.web.order.form.OrderForm" resultType="int">
		select count(1) from
		   (select t.sale_flow     saleFlow,
		       t.game_code     gameCode,
		       t.dealer_code   dealerCode,
		       i.full_name     gameName,
		       t.issue_number  issueNumber,
		       t.order_amount  orderAmount,
		       t.reward_amount rewardAmount,
		       t.paid_time     paidTime,
		       s.order_time    orderTime,
		       t.is_paid       isPaid
		  from cncp_trade_paid t, inf_games i,CNCP_TRADE_SALE s
		 where t.game_code = i.game_code
		 and  t.sale_flow = s.sale_flow
	     <if test="saleFlow !=null and saleFlow != ''">
		 	and t.sale_flow = #{saleFlow}
		 </if>
		 <if test="gameCode !=null and gameCode != ''">
		 	and t.game_code = #{gameCode}
		 </if>
		 <if test="issueNumber !=null and issueNumber != ''">
		 	and t.issue_number = #{issueNumber}
		 </if>
		 <if test="dealerCode !=null and dealerCode != ''">
		 	and t.dealer_code = #{dealerCode}
		 </if>
		 <if test="isPaid !=null">
		 	and t.is_paid = #{isPaid}
		 </if>
		 <if test="startDate !=null and startDate != ''">
		 	and to_char(s.order_time,'yyyy-mm-dd') between #{startDate} and #{endDate} 
		 </if>)
	</select>
	
	<select id="getPrizeList" parameterType="cls.taishan.web.order.form.PrizeForm" resultType="cls.taishan.web.order.model.Prize">
		select * from (select tab.*, rownum rn from (
		select t.sale_flow     saleFlow,
		       t.game_code     gameCode,
		       t.dealer_code   dealerCode,
		       i.full_name     gameName,
		       t.issue_number  issueNumber,
		       t.order_amount  orderAmount,
		       t.reward_amount rewardAmount,
		       t.paid_time     paidTime,
		       s.order_time    orderTime,
		       t.is_paid       isPaid
		  from cncp_trade_paid t, inf_games i,CNCP_TRADE_SALE s
		 where t.game_code = i.game_code
		 and  t.sale_flow = s.sale_flow
		 <if test="saleFlow !=null and saleFlow != ''">
		 	and t.sale_flow = #{saleFlow}
		 </if>
		 <if test="gameCode !=null and gameCode != ''">
		 	and t.game_code = #{gameCode}
		 </if>
		 <if test="issueNumber !=null and issueNumber != ''">
		 	and t.issue_number = #{issueNumber}
		 </if>
		 <if test="isPaid !=null">
		 	and t.is_paid = #{isPaid}
		 </if>
		 <if test="startDate !=null and startDate != ''">
		 	and to_char(s.order_time,'yyyy-mm-dd') between #{startDate} and #{endDate}
		 </if> order by t.sale_flow desc
		 <![CDATA[ ) tab where rownum <= #{endNum}  ]]>  
			       ) where rn > #{beginNum}
		 <if test="sortName!=null and sortName != ''">
			  order by ${sortName} ${sortOrder}
		</if>
	</select>
	
	<select id="getPrizeDetail" parameterType="String" resultType="cls.taishan.web.order.model.Prize">
		select t.sale_flow     saleFlow,
		       t.sale_tsn      saleTsn,
		       t.game_code     gameCode,
		       t.dealer_code   dealerCode,
		       d.dealer_name   dealerName,
		       i.full_name     gameName,
		       t.issue_number  issueNumber,
		       t.order_amount  orderAmount,
		       t.reward_amount rewardAmount,
		       t.paid_time     paidTime,
		       t.is_paid       isPaid
		  from cncp_trade_paid t, inf_games i, cncp_inf_dealers d
		 where t.game_code = i.game_code 
		 and t.dealer_code = d.dealer_code
		 and t.sale_flow = #{saleFlow}
	</select>
	
</mapper>
