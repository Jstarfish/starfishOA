<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cls.pilottery.webncp.system.dao.oms.MessageServiceDao">

	<select id="getIssueCount4001" parameterType="map" resultType="Integer">
		SELECT count(t.issue_number) AS issuNum
		FROM iss_game_issue t
		WHERE 1 = 1
		<if test="perdIssue != null and perdIssue != ''">
			AND t.issue_number = #{perdIssue}
		</if>
		AND t.game_code = #{gameCode}
	</select>

	<select id="getDefaultIssue4001" parameterType="String"
		resultType="String">
		SELECT max(t.issue_number) AS current_issue_num
		FROM iss_prize t
		WHERE t.game_code = #{gameCode}
	</select>

	<select id="getDrawInfo4001" parameterType="Map"
		resultType="cls.pilottery.webncp.system.vo.Response4001Vo">
		SELECT t.game_code AS gameCode
		, t.issue_number AS perdIssue
		, t.final_draw_number AS drawCode
		, to_char(t.real_reward_time, 'YYYY-MM-DD HH24:MI:SS') AS drawTime
		FROM iss_game_issue t
		WHERE t.issue_status >= 13
		<if test="gameCode != null and gameCode != ''">
			AND t.game_code = #{gameCode}
		</if>
		<if test="perdIssue != null and perdIssue != ''">
			AND t.issue_number = #{perdIssue}
		</if>
		ORDER BY t.issue_number DESC
	</select>

	<select id="getPrizeLevelInfo4001" parameterType="Map"
		resultType="cls.pilottery.webncp.system.model.Response4001Record">
		SELECT t.prize_level AS winLevel
		, t.prize_name AS winName
		, t.prize_count AS saleCount
		, t.single_bet_reward AS singleBet
		, (t.prize_count * t.single_bet_reward) AS winSum
		FROM iss_prize t
		LEFT JOIN gp_prize_rule r ON t.game_code = r.game_code AND t.prize_level =
		r.prule_level
		WHERE t.issue_number = #{perdIssue}
		AND t.game_code = #{gameCode}
		ORDER BY r.disp_order
	</select>

	<select id="getIssueCount4002" parameterType="Map" resultType="Integer">
		SELECT count(t.issue_number) AS issuNum
		FROM iss_game_issue t
		WHERE 1 = 1
		<if test="perdIssue != null and perdIssue != ''">
			AND t.issue_number = #{perdIssue}
		</if>
		AND t.game_code = #{gameCode}
	</select>

	<select id="getDefaultIssue4002" parameterType="Map" resultType="String">
		SELECT max(t.issue_number)
		FROM mis_agency_win_stat t
		WHERE t.game_code = #{gameCode}
		AND t.agency_code = #{agencyCode}
	</select>

	<select id="getDrawInfo4002" parameterType="Map"
		resultType="cls.pilottery.webncp.system.vo.Response4002Vo">
		SELECT DISTINCT t.game_code AS gameCode
		, t.issue_number AS perdIssue
		, a.final_draw_number AS drawCode
		FROM mis_agency_win_stat t
		JOIN iss_game_issue a ON t.issue_number = a.issue_number AND t.game_code =
		a.game_code
		WHERE t.game_code = #{gameCode}
		AND t.agency_code = #{agencyCode}
		AND t.issue_number = #{perdIssue}
	</select>

	<select id="getPrizeLevelInfo4002" parameterType="Map"
		resultType="cls.pilottery.webncp.system.model.Response4002Record">
		SELECT t.prize_level AS winLevel
		, t.winning_count AS saleCount
		, t.single_bet_reward AS singleBet
		, t.prize_name AS winName
		, (t.winning_count * t.single_bet_reward) AS winSum
		FROM mis_agency_win_stat t
		LEFT JOIN gp_prize_rule r ON t.game_code = r.game_code AND t.prize_level =
		r.prule_level
		WHERE t.game_code = #{gameCode}
		AND t.agency_code = #{agencyCode}
		AND t.issue_number = #{perdIssue}
		ORDER BY r.disp_order
	</select>

	<select id="getAreaCode4003" parameterType="String" resultType="String">
		SELECT t.area_code AS areaCode
		FROM saler_agency t
		WHERE t.agency_code = #{agencyCode}
	</select>

	<select id="getNoticeList4003" parameterType="Map"
		resultType="cls.pilottery.webncp.system.model.Response4003Record">
		SELECT * FROM (
		SELECT rownum rn, R.* FROM (
		SELECT t.notice_id AS notCode
		, to_char(t.create_time, 'YYYY-MM-DD HH24:MI:SS') AS sendTime
		, t.title AS title
		FROM msg_agency_brocast t
		WHERE t.notice_id IN (
		SELECT a.notice_id
		FROM msg_agency_brocast_detail a
		WHERE a.cast_code = #{areaCode}
		OR a.cast_code = #{agencyCode}
		OR a.cast_code = 0
		)
		ORDER BY t.create_time DESC
		<![CDATA[ 
		    ) R
		) WHERE rn > #{beginNum} AND rn <= #{endNum}
		]]>
	</select>

	<select id="getNotice4004" parameterType="String"
		resultType="cls.pilottery.webncp.system.model.Response4004Model">
		SELECT t.notice_id AS notCode
		, t.send_time AS sendTime
		, t.title AS title
		, t.content AS content
		FROM MSG_AGENCY_BROCAST t
		WHERE t.notice_id = #{notCode}
	</select>

	<select id="getIssueCount4005" parameterType="Map" resultType="Integer">
		SELECT count(t.issue_number) AS issuNum
		FROM iss_game_issue t
		WHERE t.draw_state = 16
		<if test="perdIssue != null and perdIssue != ''">
			AND t.issue_number = #{perdIssue}
		</if>
		AND t.game_code = #{gameCode}
	</select>

	<select id="getDrawNumber4005" parameterType="Map"
		resultType="cls.pilottery.webncp.system.model.Response4005Record">
		SELECT * FROM (
		SELECT rownum rn, A.* FROM (
		SELECT t.game_code AS gameCode
		, t.issue_number AS perdIssue
		, t.final_draw_number AS drawNumber
		, to_char(t.real_reward_time, 'YYYY-MM-DD HH24:MI:SS') AS drawTime
		FROM iss_game_issue t
		WHERE 1 = 1
		AND t.draw_state = 16
		AND t.game_code = #{gameCode}
		<if test="perdIssue != null and perdIssue != ''">
			AND t.issue_number >= #{perdIssue}
			ORDER BY t.issue_number
        </if>
		<if test="perdIssue == null or perdIssue == ''">
			ORDER BY t.issue_number DESC
        </if>
		<![CDATA[ 
		    ) A
		) WHERE rn > #{beginNum} AND rn <= #{endNum}
		]]>
	</select>
	
	<select id="getNewNoticeId4009" parameterType="String" resultType="String">
		SELECT MAX (a.NOTICE_ID) noticeId
		  FROM MSG_AGENCY_BROCAST_DETAIL a
		 WHERE    a.CAST_CODE = (select area_code from saler_agency where agency_code = #{agencyCode} )
		       OR a.CAST_CODE = #{agencyCode}
		       OR a.CAST_CODE = 0
	</select>

</mapper>