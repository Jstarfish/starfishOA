package cls.pilottery.common.utils;

import java.security.SecureRandom;

import javax.crypto.Cipher;
import javax.crypto.SecretKey;
import javax.crypto.SecretKeyFactory;
import javax.crypto.spec.DESKeySpec;

/**
 * des加解密的实现
 * @author huangchengyuan
 *
 */
public class EncryptUtils {

	/*
	 * 加密
	 */
	public static byte[] encrypt(byte[] datasource, String key) {
		try {
			SecureRandom random = new SecureRandom();
			DESKeySpec desKey = new DESKeySpec(key.getBytes());
			// 创建一个密匙工厂，然后用它把DESKeySpec转换成
			SecretKeyFactory keyFactory = SecretKeyFactory.getInstance("DES");
			SecretKey securekey = keyFactory.generateSecret(desKey);
			// Cipher对象实际完成加密操作
			Cipher cipher = Cipher.getInstance("DES");
			// 用密匙初始化Cipher对象
			cipher.init(Cipher.ENCRYPT_MODE, securekey, random);
			// 现在，获取数据并加密
			// 正式执行加密操作
			return cipher.doFinal(datasource);
		} catch (Throwable e) {
			e.printStackTrace();
		}
		return null;
	}

	public final static String encrypt(String password, String key) {
		try {
			return byte2String(encrypt(password.getBytes(), key));
		} catch (Exception e) {
			e.printStackTrace();
		}
		return null;

	}

	/*
	 * 解密
	 */
	public static byte[] decrypt(byte[] src, String key) throws Exception {
		// DES算法要求有一个可信任的随机数源
		SecureRandom random = new SecureRandom();
		// 创建一个DESKeySpec对象
		DESKeySpec desKey = new DESKeySpec(key.getBytes());
		// 创建一个密匙工厂
		SecretKeyFactory keyFactory = SecretKeyFactory.getInstance("DES");
		// 将DESKeySpec对象转换成SecretKey对象
		SecretKey securekey = keyFactory.generateSecret(desKey);
		// Cipher对象实际完成解密操作
		Cipher cipher = Cipher.getInstance("DES");
		// 用密匙初始化Cipher对象
		cipher.init(Cipher.DECRYPT_MODE, securekey, random);
		// 真正开始解密操作
		return cipher.doFinal(src);
	}

	public final static String decrypt(String data, String key) {
		try {
			return new String(decrypt(string2byte(data.getBytes()), key));
		} catch (Exception e) {
			e.printStackTrace();
		}
		return null;
	}

	public static String byte2String(byte[] b) {
		String hs = "";
		String stmp = "";
		for (int n = 0; n < b.length; n++) {
			stmp = (java.lang.Integer.toHexString(b[n] & 0XFF));
			if (stmp.length() == 1)
				hs = hs + "0" + stmp;
			else
				hs = hs + stmp;
		}
		return hs.toUpperCase();
	}

	public static byte[] string2byte(byte[] b) {
		if ((b.length % 2) != 0)
			throw new IllegalArgumentException("长度不是偶数");
		byte[] b2 = new byte[b.length / 2];
		for (int n = 0; n < b.length; n += 2) {
			String item = new String(b, n, 2);
			b2[n / 2] = (byte) Integer.parseInt(item, 16);
		}
		return b2;
	}

	public static void main(String[] args) throws Exception {
		String deskey = "12345678";
		
		String req = "{\"CMD\":16385,\"gameCode\":7,\"perdIssue\":2014004}";
		System.out.println(EncryptUtils.encrypt(req, deskey));
		String result = "DE5EC2F881689E89942D581E9C59B95AA29238BE68F3D5628DDBCD8D146EA18A994321FED5FBD1788A748AF6B30E741D4845E364C93C6586DA68AE5366DC847567DA4C3230F8ADC15797A64D0CD63DEAD26A091AB9468A1A4CDDA09DB9FB3EF705B3504D14BEA18A1306DA4609EF8F83EB2E0697D4D0C8F15967670D3430A39EBBEF8BF6E440BDCC67300B92698B1EFFACD773D1AC5F586C46A974B56B6372FB120ED107F17BDD597AD05CF6DA46C61525A73E4BB6F68E0255FACC412A32D6BE0F130F2CD6E23C98CBDE11BB96B84E6A9E7570F167AF1EA293FD3074389F53552BB8BBDBCB45DCA92D21E1C3A8CB09C15A590764EFC0D8FBE6582DC9036BC226A1433CD47F1F17C36E4F32B3E32AADA245BF2BA33DEBAF2A0F130F2CD6E23C98CBDE11BB96B84E6A9E7570F167AF1EA293FD3074389F53552BB8BBDBCB45DCA95A479BB085DA5079AD1316EC16F2FC9FE1D731C81392A5796D12610BB082508E960AC4C1782337E688E979FB2AF98335F0AB525B46CF1A65E61C7A01AAC93C4640505849EB75FDDD6EABC9C0FA840E2EB342DC8181E0781677B85456242FBC0E33850EFFAB1145D25A590764EFC0D8FB4F6729D785EC9E30A1433CD47F1F17C3019FAC94467CC0197BC8B4398756C1384F44E3321C49999E6859A42A585B17522B74573C54A7BC10FF66C03A31E47092649CA4D56B761A4390171F6914D2F9183ACA0F0241172998573DE31D52C3B2BDD1B798C5B059FE27726F497EC42B42127BC8B4398756C1384F44E3321C49999E6859A42A585B17522B74573C54A7BC10FF66C03A31E470923EA9D298776E9CCCD30651CF6966517046A974B56B6372FB7B2B940C8ACEE96E7AD05CF6DA46C6154E1D876F8A3DCE7AF38872ECBE13934CD812C604EB7EDBDACE700CEF8C150F9DDB090136752BB56E84C7D52BACAFDF2E4251E084BF48BB719313A51E21FFFF0E90171F6914D2F9183ACA0F0241172998338F17D475441E1CD1B798C5B059FE274DB992A3BB472F6CC54DD708B881C9A2490317D2832EDB45CADC46D102C9142993CED0CE9C76252039FB77C8FF0582C06BD8B89DCD80FD96BC69530CB2972B51E1D731C81392A579D6B231E52E3DA271826ACEA18C8A125F2A1B1C5C910C1AC6C54DD708B881C9A2490317D2832EDB45CADC46D102C9142993CED0CE9C76252039FB77C8FF0582C07323C11AA7626082AE612B72BA92B4435A590764EFC0D8FB6496535B31B8D842A1433CD47F1F17C332CBC81B581D05638FB3188832C84D22F368E1AA8E11D689B9D9C0D03EC0F5CC0825C911B9388419EA704761627A141F83417A2C2BBC3195D084CEA7853F5363BC69530CB2972B51E1D731C81392A579F184BF78220B68BECF6C29341DF27FC3E6B54098FDE12D1AF368E1AA8E11D689B9D9C0D03EC0F5CC0825C911B9388419EA704761627A141F83417A2C2BBC31954E3E6938D8F1B8821F6A216EC670EEFCC8304C36572E59A9CCF622F894803C4C826ACEA18C8A125F2A1B1C5C910C1AC6C54DD708B881C9A2490317D2832EDB45CADC46D102C9142993CED0CE9C76252039FB77C8FF0582C07323C11AA7626082AE612B72BA92B4435A590764EFC0D8FB9CFFED54E91541A460052D9CA80CCE9B20196EF53C779F3B32DF34F4EF74707CC54DD708B881C9A2490317D2832EDB45CADC46D102C9142993CED0CE9C76252039FB77C8FF0582C0AFB2BF97C2EFDF32AD94F496D4E03B815E9B5D49743703AC8F824844119BEB95D1B798C5B059FE274DB992A3BB472F6CC54DD708B881C9A2490317D2832EDB45CADC46D102C9142993CED0CE9C76252039FB77C8FF0582C06BD8B89DCD80FD96BC69530CB2972B51E1D731C81392A579636F2E2B756A59CAC175CC41352C078EE3E39327F118D935D812C604EB7EDBDACE700CEF8C150F9D381233996418641C";
		System.out.println(EncryptUtils.decrypt(result, deskey));

	}

}
