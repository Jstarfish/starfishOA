<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cls.pilottery.oms.game.dao.FundManagementDao">

    <resultMap type="cls.pilottery.oms.game.model.FundAdj" id="fundAdj">
        <id column="ADJ_FLOW" property="adjFlow" jdbcType="CHAR" javaType="java.lang.String"/>
		<result column="GAME_CODE" property="gameCode" />
        <result column="ADJ_AMOUNT" property="adjAmount" />
        <result column="ADJ_AMOUNT_BEFORE" property="adjAmountBefore" />
        <result column="ADJ_AMOUNT_AFTER" property="adjAmountAfter" />
        <result column="ADJ_CHANGE_TYPE" property="adjChangeType" />
        <result column="ADJ_DESC" property="adjDesc" />
        <result column="ADJ_TIME" property="adjTime" />
        <result column="ADJ_ADMIN" property="adjAdmin" />
    </resultMap>
    <resultMap type="cls.pilottery.oms.game.model.FundAdjHistory" id="fundAdjHistory">
		<id column="ADJ_FLOW" property="adjFlow" jdbcType="CHAR" javaType="java.lang.String"/>
        <result column="HIS_CODE" property="hisCode" />
        <result column="GAME_CODE" property="gameCode" />
        <result column="ISSUE_NUMBER" property="issueNumber" />
        <result column="ADJ_CHANGE_TYPE" property="adjChangeType" />
        <result column="ADJ_AMOUNT" property="adjAmount" />
        <result column="ADJ_AMOUNT_BEFORE" property="adjAmountBefore" />
        <result column="ADJ_AMOUNT_AFTER" property="adjAmountAfter" />
        <result column="ADJ_TIME" property="adjTime" />
        <result column="ADJ_REASON" property="adjReason" />
    </resultMap>
    <resultMap type="cls.pilottery.oms.game.model.GovernmentCommision" id="governmentCommision">
        <id column="HIS_CODE" property="hisCode" />
        <id column="GAME_CODE" property="gameCode" />
        <result column="ISSUE_NUMBER" property="issueNumber" />
        <result column="COMM_CHANGE_TYPE" property="commChangeType" />
        <result column="ADJ_AMOUNT" property="adjAmount" />
        <result column="ADJ_AMOUNT_BEFORE" property="adjAmountBefore" />
        <result column="ADJ_AMOUNT_AFTER" property="adjAmountAfter" />
        <result column="ADJ_TIME" property="adjTime" />
        <result column="ADJ_REASON" property="adjReason" />
    </resultMap>
    
	<resultMap type="cls.pilottery.oms.game.model.FundAdjHistoryVo" id="fundAdjHistoryVo">
		<result column="ISSUE_NUMBER" property="issueNumber" />
		<result column="REAL_REWARD_TIME" property="realRewardTime" />
		<result column="ADJ_AMOUNT_BEFORE" property="adjAmountBefore" />
		<result column="ADJ_AMOUNT_AFTER" property="adjAmountAfter" />
		<result column="ADJ_AMOUNT" property="adjAmount" />
	</resultMap>
    
    
	<select id="getFundAdjListCount" parameterType="cls.pilottery.oms.game.form.FundManagementForm" resultType="Integer">
		select count(1) from adj_game_his d where d.GAME_CODE=${fundAdj.gameCode} 
			<if test="str_adjTime1 != null and str_adjTime1 != ''">
			 <![CDATA[ and to_char(d.adj_time,'yyyy-MM-dd') >= '${str_adjTime1}' ]]>
			</if>
			<if test="str_adjTime2 != null and str_adjTime2 != ''">
			 <![CDATA[ and to_char(d.adj_time,'yyyy-MM-dd') <= '${str_adjTime2}' ]]>
			</if>
	</select>
	<select id="getFundAdjList" parameterType="cls.pilottery.oms.game.form.FundManagementForm" resultMap="fundAdjHistory">
		select * from (
		select a.*,rownum rn from (
		select * from adj_game_his d where d.GAME_CODE=${fundAdj.gameCode} 
		<if test="str_adjTime1 != null and str_adjTime1 != ''">
		 <![CDATA[ and to_char(d.adj_time,'yyyy-MM-dd') >= '${str_adjTime1}' ]]>
		</if>
		<if test="str_adjTime2 != null and str_adjTime2 != ''">
		 <![CDATA[ and to_char(d.adj_time,'yyyy-MM-dd') <= '${str_adjTime2}' ]]>
		</if>
	<![CDATA[ order by d.adj_time DESC) a ) where rn > ${fundAdj.beginNum} and rn <= ${fundAdj.endNum} ]]>
	</select>
	<insert id="insertFundAdj" statementType="CALLABLE" parameterType="cls.pilottery.oms.game.model.FundAdj">  
		{
        	call p_om_issue_adjfund_modify(
			 	#{gameCode,mode=IN,jdbcType=NUMERIC},
			 	#{adjAmount,mode=IN,jdbcType=NUMERIC},
			 	#{adjChangeType,mode=IN,jdbcType=NUMERIC},
			 	#{adjDesc,mode=IN,jdbcType=VARCHAR},
			 	#{adjAdmin,mode=IN,jdbcType=NUMERIC},
			 	#{c_errcode,mode=OUT,jdbcType=NUMERIC},
    	   		#{c_errmsg,mode=OUT,jdbcType=VARCHAR}
		 	)	
		}	
    </insert>  
	
	<select id="getGovernmentCommisionListCount" parameterType="cls.pilottery.oms.game.form.FundManagementForm" resultType="Integer">
		select count(1) from GOV_COMMISION d where d.GAME_CODE=${governmentCommision.gameCode} 
			<if test="str_adjTime1 != null and str_adjTime1 != ''">
			 <![CDATA[ and to_char(d.adj_time,'yyyy-MM-dd') >= '${str_adjTime1}' ]]>
			</if>
			<if test="str_adjTime2 != null and str_adjTime2 != ''">
			 <![CDATA[ and to_char(d.adj_time,'yyyy-MM-dd') <= '${str_adjTime2}' ]]>
			</if>
	</select>
	<select id="getGovernmentCommisionList" parameterType="cls.pilottery.oms.game.form.FundManagementForm" resultMap="governmentCommision">
		select * from (
		select a.*,rownum rn from (
		select * from GOV_COMMISION d where d.GAME_CODE=${governmentCommision.gameCode} 
		<if test="str_adjTime1 != null and str_adjTime1 != ''">
		 <![CDATA[ and to_char(d.adj_time,'yyyy-MM-dd') >= '${str_adjTime1}' ]]>
		</if>
		<if test="str_adjTime2 != null and str_adjTime2 != ''">
		 <![CDATA[ and to_char(d.adj_time,'yyyy-MM-dd') <= '${str_adjTime2}' ]]>
		</if>
	<![CDATA[ order by d.adj_time desc) a ) where rn > ${governmentCommision.beginNum} and rn <= ${governmentCommision.endNum} ]]>
	</select>
	
	<select id="getFundAdjHistoryListCount" parameterType="cls.pilottery.oms.game.form.FundManagementForm" resultType="Integer">
		select count(1)
			  from adj_game_his h, iss_game_issue i
			 where h.issue_number = i.issue_number
			   and h.game_code = i.game_code
			   and i.issue_status = 13 
			   and i.game_code = ${fundAdjHistoryVo.gameCode} 
	        <if test="fundAdjHistoryVo.issueNumber != null and fundAdjHistoryVo.issueNumber != 0">
				<![CDATA[ and i.ISSUE_NUMBER <= ${fundAdjHistoryVo.issueNumber} ]]>
			</if>
			<if test="beginIssue != null and beginIssue != 0">
				<![CDATA[ and i.ISSUE_NUMBER >= ${beginIssue} ]]>
			</if>
	</select>
	<select id="getFundAdjHistoryList" parameterType="cls.pilottery.oms.game.form.FundManagementForm" resultMap="fundAdjHistoryVo">
		select * from (
		select a.*,rownum rn from (
			select h.issue_number,
			       i.real_reward_time,
			       h.adj_amount_before,
			       h.adj_amount_after,
			       h.adj_amount
			  from adj_game_his h, iss_game_issue i
			 where h.issue_number = i.issue_number
			   and h.game_code = i.game_code
			   and i.issue_status = 13 
			   and i.game_code = ${fundAdjHistoryVo.gameCode} 
	        <if test="fundAdjHistoryVo.issueNumber != null and fundAdjHistoryVo.issueNumber != 0">
				<![CDATA[ and i.ISSUE_NUMBER <= ${fundAdjHistoryVo.issueNumber} ]]>
			</if>
			<if test="beginIssue != null and beginIssue != 0">
				<![CDATA[ and i.ISSUE_NUMBER >= ${beginIssue} ]]>
			</if>
	<![CDATA[ order by h.his_code desc) a ) where rn > ${fundAdjHistoryVo.beginNum} and rn <= ${fundAdjHistoryVo.endNum} ]]>
	</select>
</mapper>
