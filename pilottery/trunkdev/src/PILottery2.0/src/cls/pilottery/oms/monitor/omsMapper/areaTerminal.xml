<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cls.pilottery.oms.monitor.dao.AreaTerminalDao">
    <resultMap type="cls.pilottery.oms.monitor.model.AreaTerminal" id="areaTerminalInfo">
        <result column="ORG_CODE" property="areaCode" />
        <result column="ORG_NAME" property="areaName" />
        <result column="TOTAL_COUNT" property="totalCount" />
        <result column="ONLINE_COUNT" property="onlineCount" />
        <result column="CALC_DATE" property="calcDate" />
        <result column="CALC_TIME" property="calcTime" />
    </resultMap>

    <select id="listAllAreaTerminal" resultMap="areaTerminalInfo">
		 select *
		  from HIS_TERMINAL_ONLINE ha,
		       (select max(h.CALC_TIME) as CALC_TIME
		          FROM HIS_TERMINAL_ONLINE h
		         where 1 = 1
		         group by h.org_code) hb
		 where ha.CALC_DATE = TO_CHAR(SYSDATE, 'yyyy-mm-dd')
		   and ha.CALC_TIME = hb.CALC_TIME
	</select>
    
    <select id="listAllAreas" parameterType="cls.pilottery.oms.monitor.model.AreaTerminal"  resultMap="areaTerminalInfo">
     	select *
		  from (select sum(TOTAL_COUNT) TOTAL_COUNT,
		               sum(ONLINE_COUNT) ONLINE_COUNT,
		               CALC_TIME
		          from HIS_TERMINAL_ONLINE
		          where CALC_DATE = TO_CHAR(SYSDATE, 'yyyy-mm-dd')
		         group by CALC_TIME) m
    </select>

</mapper>
