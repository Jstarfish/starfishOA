<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cls.pilottery.web.checkTickets.dao.CheckStatisticDao">

	<select id="getCheckStatisticList" parameterType="cls.pilottery.web.checkTickets.form.CheckStatisticForm"
		resultType="cls.pilottery.web.checkTickets.model.CheckStatisticVo">
		select paid_day as paidDay,
		       PAID_ORG as paidOrg,
		       org_name as orgName,
		       nvl(love_tickets,0) + nvl(gongxi_tickets,0) + nvl(ball_tickets,0) + nvl(iphone_tickets,0) + nvl(dgl_tickets,0) as totalTickets,
      		   nvl(love_amount,0) + nvl(gongxi_amount,0) + nvl(ball_amount,0) + nvl(iphone_amount,0) + nvl(dgl_amount,0)  as totalAmount,
		       nvl(love_tickets, 0) as loveTickets,
		       nvl(love_amount, 0) as loveAmount,
		       nvl(gongxi_tickets, 0) as gongxiTickets,
		       nvl(gongxi_amount, 0) as gongxiAmount,
		       nvl(ball_tickets, 0) as ballTickets,
		       nvl(ball_amount, 0) as ballAmount,
		       nvl(iphone_tickets, 0) as iphoneTickets,
		       nvl(iphone_amount, 0) as iphoneAmount,
		       nvl(dgl_tickets, 0) as dglTickets,
		       nvl(dgl_amount, 0) as dglAmount
		  from (select trunc(PAID_TIME) paid_day,
		               f_get_old_plan_name(PLAN_CODE, batch_no) PLAN_CODE,
		               PAID_ORG,
		               orgs.org_name, 
		               count(TICKET_NO) tickets,
		               sum(REWARD_AMOUNT) amount
		          from SWITCH_SCAN_DETAIL
		          left join inf_orgs orgs
		            on PAID_ORG = orgs.org_code
		         where PAID_TIME >= to_date(#{beginDate}, 'yyyy-MM-dd')
		         <![CDATA[  and PAID_TIME < to_date(#{endDate}, 'yyyy-MM-dd') + 1 ]]>
		           and paid_status = 1
		         group by trunc(PAID_TIME),
		                  PAID_ORG,
		                  orgs.org_name, 
		                  f_get_old_plan_name(PLAN_CODE, batch_no))
		pivot(sum(tickets) as tickets, sum(amount) as amount
		   for PLAN_CODE in('Love' as love,
		                    'GongXi' as gongxi,
		                    'Ball' as ball,
		                    'Iphone' as iphone,
		                    'DGL' as dgl))
		where 1=1 
		<if test="orgCode!='00'">
			and PAID_ORG = #{orgCode}  
		</if>
		order by PAIDDAY desc,paidorg   		                    
	</select>
	<select id="getRefuseRecordsListInfo" parameterType="cls.pilottery.web.checkTickets.form.CheckStatisticForm"
		resultType="cls.pilottery.web.checkTickets.model.CheckStatisticVo">
			select orgs.org_name as orgName,
		       a.admin_realname as operName,
		       D.PLAN_CODE ||'-'|| D.BATCH_NO ||'-'|| D.PACKAGE_NO ||'-'|| D.TICKET_NO as tickNo,
		       d.PAID_TIME      as paidDay
		  from SWITCH_SCAN_DETAIL d
		  left join inf_orgs orgs
		    on orgs.org_code = d.PAID_ORG
		    left join adm_info a on a.admin_id=d.PAID_ADMIN
		    where 1=1
		    <if test="orgCode!='00'">
		     and d.PAID_ORG=#{orgCode}
		    </if>
			and d.PAID_STATUS=7
			order by d.PAID_TIME desc
	</select>
	
</mapper>
