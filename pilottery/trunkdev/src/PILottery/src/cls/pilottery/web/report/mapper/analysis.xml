<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cls.pilottery.web.report.dao.AnalysisStatisticsDao">
	<select id="getAgencyInfoList"  resultType="cls.pilottery.web.report.model.OutletInfoVO" parameterType="cls.pilottery.web.report.form.AnalysisStatisticsForm">
		with agency as (
			SELECT AGENCY_CODE agencyCode,
	               AGENCY_NAME agencyName,
	               ADMIN_REALNAME marketManager,
	               AREA_NAME areaName,
	               TELEPHONE telephone,
	               CONTACT_PERSON contactPerson,
	               A.ADDRESS address,
	               to_char(AGENCY_ADD_TIME,'yyyy-mm-dd') addTime,
	               CONTRACT_NO contractNo,
	               CREDIT_LIMIT credit,
	               ORG_CODE orgCode,
	               ORG_NAME orgName
	          FROM INF_AGENCYS A
	          join INF_AGENCY_EXT using (AGENCY_CODE)
	          join ACC_AGENCY_ACCOUNT using (AGENCY_CODE)
	          join adm_info on (MARKET_MANAGER_ID = ADMIN_ID)
	          join INF_AREAS using (AREA_CODE)
	          join inf_orgs using (org_code)
		),
		comm as (
		    select agency_code agencyCode,sale_comm saleComm,pay_comm payComm from GAME_AGENCY_COMM_RATE     
		    group by agency_code,sale_comm,pay_comm
		)          
		select * from agency
		join comm using (agencyCode)      
		where 1=1
		  <if test="beginDate != null and beginDate != ''">
				AND addTime between #{beginDate} and #{endDate}
		  </if>
		  <if test="institutionCode != null and institutionCode != ''">
				AND orgCode = #{institutionCode}
		  </if>
		  <if test="cuserOrg != '00'">
				and orgCode = #{cuserOrg}
		  </if>
		  <if test="outletCode != null and outletCode !=''">
				and agencyCode = #{outletCode}
		  </if>
		  ORDER BY orgCode,agencyCode
	</select>
</mapper>