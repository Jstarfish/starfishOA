<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cls.pilottery.web.report.dao.GoodsReceiptsReportDao">
	<select id="getheadWhouseList"  resultType="cls.pilottery.web.warehouses.model.WarehouseInfo">
			select distinct m.warehouse_code as warehouseCode,
		        wh.warehouse_name as warehouseName
		   from wh_manager m
		   left join WH_INFO wh
		    on m.warehouse_code = wh.warehouse_code
		    where m.is_valid=1 and m.org_code='00'
	</select>
	<select id="getReceiptsReportList" parameterType="cls.pilottery.web.report.form.GoodsReceiptsReportForm" 
	resultType="cls.pilottery.web.report.model.GoodsReceiptsReportVo">
		SELECT   PLAN_CODE planCode,
		         FULL_NAME planName,
		         ADMIN_REALNAME deliverName,
		         WAREHOUSE_CODE whouseCode,
		         WAREHOUSE_NAME whouseName,
		         SUM (TICKETS) tickets,
		         SUM (AMOUNT) amount,
		         ROUND(SUM (AMOUNT)/ f_get_sys_param(100),3) amountDollar
		    FROM WH_GOODS_RECEIPT_DETAIL
		         JOIN adm_info ON (CREATE_ADMIN = admin_id)
		         JOIN WH_MANAGER ON (MANAGER_ID = CREATE_ADMIN)
		         JOIN GAME_PLANS USING (PLAN_CODE)
		         JOIN wh_info  USING (WAREHOUSE_CODE)
		   WHERE receipt_type = 1
		   <if test="whouseCode!=null and whouseCode!=''">
		    	and  WAREHOUSE_CODE=#{whouseCode} 
		   </if>
		GROUP BY PLAN_CODE,
		         FULL_NAME,
		         ADMIN_REALNAME,
		         WAREHOUSE_CODE,
		         WAREHOUSE_NAME
		ORDER BY WAREHOUSE_CODE, PLAN_CODE
	</select>
	<select id="getheadWhouseListSum" parameterType="cls.pilottery.web.report.form.GoodsReceiptsReportForm" 
	resultType="cls.pilottery.web.report.model.GoodsReceiptsReportVo">
		  SELECT SUM (TICKETS) tickets,
		         SUM (AMOUNT) amount,
		         ROUND(SUM (AMOUNT)/ f_get_sys_param(100),3) amountDollar
		    FROM WH_GOODS_RECEIPT_DETAIL
		         JOIN WH_MANAGER ON (MANAGER_ID = CREATE_ADMIN)
		   WHERE receipt_type = 1
		   <if test="whouseCode!=null and whouseCode!=''">
		    	and  WAREHOUSE_CODE=#{whouseCode} 
		   </if>
	</select>
	
	
    <select id="getOutReportList" parameterType="cls.pilottery.web.report.form.GoodsReceiptsReportForm" resultType="cls.pilottery.web.report.model.GoodsReceiptsReportVo">
		SELECT   a1.sgi_no sqe,
		         ai.ADMIN_REALNAME deliverName,
		         b1.issue_end_time rereceiptTime,
		         g1.full_name planName,
		         wi.WAREHOUSE_NAME whouseName,
		         o1.org_name insName,
		         SUM (a1.tickets) tickets,
		         SUM (a1.amount) AS amount,
		         ROUND(SUM (a1.AMOUNT)/ f_get_sys_param(100),3) amountDollar
		    FROM wh_goods_issue_detail a1
		         LEFT JOIN wh_goods_issue b1 ON a1.sgi_no = b1.sgi_no
		         LEFT JOIN sale_transfer_bill c1 ON a1.ref_no = c1.stb_no
		         LEFT JOIN inf_orgs o1 ON c1.receive_org = o1.org_code
		         LEFT JOIN game_plans g1 ON a1.plan_code = g1.plan_code
		         JOIN ADM_INFO ai ON b1.create_admin = ai.ADMIN_ID
		         JOIN WH_INFO wi on b1.send_wh = WI.WAREHOUSE_CODE
		   WHERE b1.issue_type = 1 and b1.SEND_ORG = '00'
		     AND to_char(b1.ISSUE_END_TIME,'yyyy-mm-dd') between #{begDate} and #{endDate}
            <if test="whouseCode!=null and whouseCode!=''">
            	and b1.SEND_WH=#{whouseCode} 
            </if>
		GROUP BY a1.sgi_no,
		         a1.ref_no,
		         ai.ADMIN_REALNAME,
		         b1.issue_end_time,
		         g1.full_name,
		         wi.WAREHOUSE_NAME,
		         o1.org_name
		ORDER BY wi.WAREHOUSE_NAME,b1.issue_end_time desc,full_name
    </select>
    <select id="getheadWhouseListOutSum" parameterType="cls.pilottery.web.report.form.GoodsReceiptsReportForm" resultType="cls.pilottery.web.report.model.GoodsReceiptsReportVo">
         select sum(nvl(ACT_ISSUE_TICKETS,0)) tickets,
         		sum(nvl(ACT_ISSUE_AMOUNT,0)) amount,
         		ROUND(SUM(NVL(ACT_ISSUE_AMOUNT, 0)) / F_GET_SYS_PARAM(100), 3) AS amountDollar
           from wh_goods_issue b1 
          WHERE b1.issue_type = 1 and b1.SEND_ORG = '00'
		    AND to_char(b1.ISSUE_END_TIME,'yyyy-mm-dd') between #{begDate} and #{endDate}
            <if test="whouseCode!=null and whouseCode!=''">
            	and b1.SEND_WH=#{whouseCode} 
            </if>
    </select>
</mapper>