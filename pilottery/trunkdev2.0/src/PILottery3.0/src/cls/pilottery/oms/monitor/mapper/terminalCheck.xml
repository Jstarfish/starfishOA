<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cls.pilottery.oms.monitor.dao.CheckDao">

	<select id="getCheckList" resultType="cls.pilottery.oms.monitor.model.TerminalCheck"
		parameterType="cls.pilottery.oms.monitor.form.TerminalCheckForm">
		select *
	  from (select tab.*, rownum rn
	          from (with agencyInfo as (select i.agency_code,
	                                           i.agency_name,
	                                           i.org_code,
	                                           st.terminal_code
	                                      from inf_agencys i
	                                      left join saler_terminal st
	                                        on i.agency_code = st.agency_code)
	                 select s.agency_code as agencyCode,
	                        s.agency_name as agencyName,
	                         s.org_code as orgCode,
	                        t.check_time as checkTime,
	                        t.term_check_id as termCheckId,
	                        t.terminal_code as terminalCode,
	                        a.admin_realname as termCheckName
	                   from SALER_TERMINAL_CHECK t
	                   left join ADM_INFO a
	                     on t.COLLECTER_ID = a.admin_id
	                   left join agencyInfo s
	                     on t.terminal_code = s.terminal_code
	                  where to_char(t.check_time, 'yyyy-mm-dd') between
	                        #{beginDate} and #{endDate}
		<if test="termCheckName != null and termCheckName != ''">
		  and a.admin_realname=#{termCheckName}
		</if>
		<if test="cuserOrg != '00' ">
			and s.org_code = #{cuserOrg}
		</if>
		<if test="orgCode != null and orgCode != ''">
			and s.org_code = #{orgCode}
		</if>
		
		ORDER BY t.check_time DESC
	<![CDATA[ ) TAB ) where rn > ${beginNum} and rn <= ${endNum} ]]>
	</select>


	<select id="getCheckCount" parameterType="cls.pilottery.oms.monitor.form.TerminalCheckForm" resultType="int">
		select count(*)
		  from (with agencyInfo as (select i.agency_code,
	                                           i.agency_name,
	                                           i.org_code,
	                                           st.terminal_code
	                                      from inf_agencys i
	                                      left join saler_terminal st
	                                        on i.agency_code = st.agency_code)
	                 select s.agency_code as agencyCode,
	                        s.agency_name as agencyName,
	                         s.org_code as orgCode,
	                        t.check_time as checkTime,
	                        t.term_check_id as termCheckId,
	                        t.terminal_code as terminalCode,
	                        a.admin_realname as termCheckName
	                   from SALER_TERMINAL_CHECK t
	                   left join ADM_INFO a
	                     on t.COLLECTER_ID = a.admin_id
	                   left join agencyInfo s
	                     on t.terminal_code = s.terminal_code
	                  where to_char(t.check_time, 'yyyy-mm-dd') between
	                        #{beginDate} and #{endDate}
		<if test="termCheckName != null and termCheckName != ''">
			AND a.admin_realname = #{termCheckName}
		</if>
		<if test="orgCode != null and orgCode != ''">
			and s.org_code = #{orgCode}
		</if>
		<![CDATA[ ) ]]>
	</select>

</mapper>
