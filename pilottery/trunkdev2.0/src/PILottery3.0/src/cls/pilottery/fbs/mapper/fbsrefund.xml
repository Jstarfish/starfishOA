<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cls.pilottery.fbs.dao.FbsRefundDao">
	<select id="getSaleCancelCount" parameterType="cls.pilottery.oms.lottery.form.SaleCancelInfoForm"
		resultType="Integer">
		select count(1)
		from SALE_CANCELINFO s
		left join INF_GAMES ga
		on s.game_code = ga.game_code
		where s.game_code = 14
		<if test="canceler != null and canceler !=''">
			and s.CANCELER_NAME = #{canceler}  
        </if>
		<if test="satrtcancelTime != null and satrtcancelTime != ''">  
            <![CDATA[and to_char(s.CANCEL_TIME,'yyyy-MM-dd') >=#{satrtcancelTime}]]>
		</if>
		<if test="endcancelTime!=null and endcancelTime!=''">
         	<![CDATA[and  to_char(s.CANCEL_TIME,'yyyy-MM-dd')<=#{endcancelTime}]]>
		</if>
		<if test="areaCode!=null and areaCode!=''">
			<if test="areaCode!=0">
				and	s.CANCEL_ORG_CODE like #{ areaCode}||'%'
        	</if>
		</if>
	</select>
	<select id="getSaleCancelList" parameterType="cls.pilottery.oms.lottery.form.SaleCancelInfoForm"
		resultType="cls.pilottery.oms.lottery.vo.SaleCancelInfoVo">
		select *
		from (select b.*,rownum rn from  (select s.CANCELER_NAME as canceler,
		s.cancel_time as cancelTime,
		s.gui_cancel_flow as id,
		ga.short_name as gameName,
		s.is_success as isSuccess,
		s.cancel_amount as cancelAmount,
		s.sale_tsn as saleTsn,
		s.sale_agency_code as saleAgencyCode,
		s.CANCEL_ORG_CODE as cancelAgencyCode,
		s.cancel_comm as cancelComm,
		s.cancel_tsn as cancelTsn
		from SALE_CANCELINFO s
		left join INF_GAMES ga
		on s.game_code = ga.game_code
		where s.game_code = 14
		<if test="canceler != null and canceler !=''">
			and s.CANCELER_NAME = #{canceler}  
        </if>
		<if test="satrtcancelTime != null and satrtcancelTime != ''">  
            <![CDATA[and to_char(s.CANCEL_TIME,'yyyy-MM-dd') >=#{satrtcancelTime}]]>
		</if>
		<if test="endcancelTime!=null and endcancelTime!=''">
         	<![CDATA[and to_char(s.CANCEL_TIME,'yyyy-MM-dd')<=#{endcancelTime}]]>
		</if>
		<if test="areaCode!=null and areaCode!=''">
			<if test="areaCode!=0">
				and	s.CANCEL_ORG_CODE like #{ areaCode}||'%'
        	</if>
		</if>
		 order by s.cancel_time desc
		) b ) where
    <![CDATA[
      rn  >
    ${beginNum}  and rn  <= ${endNum}
    ]]>
	</select>
</mapper>
